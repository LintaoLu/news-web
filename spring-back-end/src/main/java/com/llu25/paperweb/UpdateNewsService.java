package com.llu25.paperweb;

import com.google.gson.JsonArray;
import com.google.gson.JsonElement;
import com.google.gson.JsonObject;
import com.google.gson.JsonParser;
import java.util.*;

public class UpdateNewsService extends TimerTask {

    private PaperWebApplication paperWebApplication;

    public UpdateNewsService(PaperWebApplication p) {
        paperWebApplication = p;
    }

    private void getAllNews() {
        LRU<List<News>> lru = new LRU<>(20);
        String json = getJson(NewsType.ALL);
        List<News> list = new LinkedList<>();
        int counter = 0;
        JsonArray jsonArray = new JsonParser().parse(json).getAsJsonObject().get("articles").getAsJsonArray();
        for (JsonElement news : jsonArray) {
            if (counter % Utils.newsPerList == 0) {
                lru.set(counter / Utils.newsPerList, list);
                list = new LinkedList<>();
            }
            JsonObject newsObj = news.getAsJsonObject();
            String source = newsObj.getAsJsonObject("source").get("name").isJsonNull() ? "" : newsObj.getAsJsonObject("source").get("name").getAsString();
            String author = newsObj.get("author").isJsonNull() ? "Unknown" : newsObj.get("author").getAsString();
            String title = newsObj.get("title").isJsonNull() ? "No title" : newsObj.get("title").getAsString();
            String description = newsObj.get("description").isJsonNull() ? "" : newsObj.get("description").getAsString();
            String url = newsObj.get("url").isJsonNull() ? "#" : newsObj.get("url").getAsString();
            String urlToImage = newsObj.get("urlToImage").isJsonNull() ? "assets/images/img_not_find.jpg" : newsObj.get("urlToImage").getAsString();
            String publishedAt = newsObj.get("publishedAt").isJsonNull() ? "" : newsObj.get("publishedAt").getAsString();
            list.add(new News(source, author, title, description, url, urlToImage, publishedAt));
            counter++;
        }
        paperWebApplication.getNews().put(NewsType.ALL, lru);
    }

    private String getJson(NewsType type) {
        return "{\"status\":\"ok\",\"totalResults\":4319,\"articles\":[{\"source\":{\"id\":null,\"name\":\"Ehackingnews.com\"},\"author\":\"Toshavi Newaskar\",\"title\":\"Double Extortion- A Ransomware Tactic That Leaves The Victims With No Choice!\",\"description\":\"The ransomware attackers doubly pressure the victims to pay up and threaten them with leaking data or even hiking the amount of the ransom.\",\"url\":\"https://www.ehackingnews.com/2020/04/double-extortion-ransomware-tactic-that.html\",\"urlToImage\":\"https://1.bp.blogspot.com/-2B_QuP2yHTY/Xpm_hyophsI/AAAAAAAAKqE/1scRoC9Ag9smxIqN460Z3ZdC8iLzp4LkwCLcBGAsYHQ/w1200-h630-p-k-no-nu/55.jpg\",\"publishedAt\":\"2020-04-17T15:35:00Z\",\"content\":\"In addition to all the reasons ransomware were already dangerous and compulsive, there’s another one that the recent operators are employing to scare the wits out of their targets. Cyber-criminals now tend to be threatening their victims with publishing and c… [+3919 chars]\"},{\"source\":{\"id\":null,\"name\":\"Cointelegraph.com\"},\"author\":\"Cointelegraph By Michael Garbade\",\"title\":\"10 Things Every Blockchain Engineer Should Know in 2020\",\"description\":\"The blockchain tech industry has dramatically changed over the past 10 years: Here’s what you should know about it\",\"url\":\"https://cointelegraph.com/news/10-things-every-blockchain-engineer-should-know-in-2020\",\"urlToImage\":\"https://images.cointelegraph.com/images/740_aHR0cHM6Ly9zMy5jb2ludGVsZWdyYXBoLmNvbS9zdG9yYWdlL3VwbG9hZHMvdmlldy9mYTdkZGZkNjBhNjU1ODJjM2RiNjI2NWJjZTY2OTc2ZS5qcGc=.jpg\",\"publishedAt\":\"2020-04-17T15:32:00Z\",\"content\":\"Blockchain is no longer just the backbone of Bitcoin (BTC) or cryptocurrencies. It is more than that. Its application in various industries is as wide as the seas. And despite the technology’s limitations and challenges, demand for blockchain engineers increa… [+6271 chars]\"},{\"source\":{\"id\":null,\"name\":\"Cointelegraph.com\"},\"author\":\"Cointelegraph By Jack Martin\",\"title\":\"CoinMarketCap Traffic From Women & Young Adults on the Rise Amid Lockdown\",\"description\":\"Chinese investors have better things to do than check CMC, although young women are taking a greater interest on a macro-economic level\",\"url\":\"https://cointelegraph.com/news/coinmarketcap-traffic-from-women-young-adults-on-the-rise-amid-lockdown\",\"urlToImage\":\"https://images.cointelegraph.com/images/740_aHR0cHM6Ly9zMy5jb2ludGVsZWdyYXBoLmNvbS9zdG9yYWdlL3VwbG9hZHMvdmlldy9mYzE0NTI4YmRlMGJmNTdkMjE1ODY1YmU5ODJiOGRlYy5qcGc=.jpg\",\"publishedAt\":\"2020-04-17T15:30:00Z\",\"content\":\"April 17, as part of the BlockDown 2020 online blockchain conference, CoinMarketCap’s Chief Strategy Officer and Interim CEO, Carylyne Chan, presented the company’s report into the cryptocurrency market for the first quarter of 2020.\\r\\nTrends analyzed through … [+2733 chars]\"},{\"source\":{\"id\":null,\"name\":\"Www.e15.cz\"},\"author\":\"Jan Vávra\",\"title\":\"Krypto-graf týdne: Utrácejí Američané vládní šeky za bitcoin? Kryptoměna posílila\",\"description\":\"Pokud vám vláda rozdá peníze, nakupujte bitcoin, zlato nebo stříbro. Tohle radil autor knihy Bohatý táta, chudý táta Robert Kiyosaki všem příjemcům státních záchranných balíčků. Řadě Američanů přišly tento týden šeky na 1200 dolarů a propagátoři kryptoměn spe…\",\"url\":\"https://www.e15.cz/kryptomeny/krypto-graf-tydne-utraceji-americane-vladni-seky-za-bitcoin-kryptomena-posilila-1368822\",\"urlToImage\":\"https://img.cncenter.cz/img/11/normal690/6120678_bitcoin-kryptomeny-wallet-penezenka-mobil-v0.jpg?v=0\",\"publishedAt\":\"2020-04-17T15:15:00Z\",\"content\":\"Pokud vám vláda rozdá peníze, nakupujte bitcoin, zlato nebo stíbro. Tohle radil autor knihy Bohatý táta, chudý táta Robert Kiyosaki vem píjemcm státních záchranných balík. ad Amerian pily tento týden eky na 1200 dolar a propagátoi kryptomn spekulují, jak moc … [+2086 chars]\"},{\"source\":{\"id\":null,\"name\":\"Bitcoinist.com\"},\"author\":\"Tony Spilotro\",\"title\":\"Ominous Bitcoin Price Fractal Reveals Repeat of Record Selloff\",\"description\":\"The recent recovery in Bitcoin price has bulls breathing a sigh of relief, hoping that the worst part of the coronavirus market panic is now behind us. But an ominous fractal has appeared on Bitcoin price charts, potentially warning of a repeat of the record-…\",\"url\":\"https://bitcoinist.com/ominous-bitcoin-price-fractal-reveals-repeat-of-record-selloff/\",\"urlToImage\":\"https://bitcoinist.com/wp-content/uploads/2020/04/lightning-801866_1280.jpg\",\"publishedAt\":\"2020-04-17T15:04:58Z\",\"content\":\"The recent recovery in Bitcoin price has bulls breathing a sigh of relief, hoping that the worst part of the coronavirus market panic is now behind us. But an ominous fractal has appeared on Bitcoin price charts, potentially warning of a repeat of the record-… [+2713 chars]\"},{\"source\":{\"id\":null,\"name\":\"Thedailymash.co.uk\"},\"author\":\"The Daily Mash\",\"title\":\"Your four worst exes to text right now, ranked\",\"description\":\"LONELY? Here are the four of worst ex-lovers to start a texting spree with now you’re feeling unloved in lockdown.\",\"url\":\"https://www.thedailymash.co.uk/news/relationships/your-four-worst-exes-to-text-right-now-ranked-20200417195544\",\"urlToImage\":\"https://cdn.thedailymash.co.uk/wp-content/uploads/20200416215336/woman-texting-22.jpg\",\"publishedAt\":\"2020-04-17T15:00:44Z\",\"content\":\"LONELY? Here are the four of worst ex-lovers to start a texting spree with now youre feeling unloved in lockdown:\\r\\nThe one you went on two Tinder dates with\\r\\nThis one seemed fine until you went back to their house and they showed you a lock of hair from their… [+1318 chars]\"},{\"source\":{\"id\":null,\"name\":\"Slashgear.com\"},\"author\":\"Chris Davies\",\"title\":\"Coronavirus scams are skyrocketing: Here’s what Gmail spam filters are catching\",\"description\":\"Coronavirus confusion is proving to be rich pickings for scammers, with Google revealing just how much COVID-19 related spam it’s currently catching in its Gmail filters. Warnings around potential scams and phishing attacks using the current pandemic as a hoo…\",\"url\":\"https://www.slashgear.com/coronavirus-scams-are-skyrocketing-heres-what-gmail-spam-filters-are-catching-17617176/\",\"urlToImage\":\"https://scdn.slashgear.com/wp-content/uploads/2020/04/gmail-spam-1.jpg\",\"publishedAt\":\"2020-04-17T14:44:12Z\",\"content\":\"Coronavirus confusion is proving to be rich pickings for scammers, with Google revealing just how much COVID-19 related spam it’s currently catching in its Gmail filters. Warnings around potential scams and phishing attacks using the current pandemic as a hoo… [+2859 chars]\"},{\"source\":{\"id\":null,\"name\":\"Seclists.org\"},\"author\":null,\"title\":\"Wappalyzer discloses security breach after hacker starts emailing users\",\"description\":\"Posted by Destry Winant on Apr 17 https://www.zdnet.com/article/wappalyzer-discloses-security-breach-after-hacker-starts-emailing-users/ Tech company Wappalyzer has disclosed a security incident this week after a hacker began emailing its customers and offeri…\",\"url\":\"https://seclists.org/dataloss/2020/q2/45\",\"urlToImage\":\"http://seclists.org/images/dataloss-img.png\",\"publishedAt\":\"2020-04-17T14:43:57Z\",\"content\":\"BreachExchange\\r\\nmailing list archives\\r\\nWappalyzer discloses security breach after hackerstarts emailing users\\r\\nFrom: Destry Winant &lt;destry () riskbasedsecurity com&gt;Date: Fri, 17 Apr 2020 09:10:16 -0500\\r\\nhttps://www.zdnet.com/article/wappalyzer-discloses… [+3960 chars]\"},{\"source\":{\"id\":null,\"name\":\"Cointelegraph.com\"},\"author\":\"Cointelegraph By Andrew Singer\",\"title\":\"Wright v. Kleiman Enters Final Act — Document Reveal May Set Precedent\",\"description\":\"Kleiman v. Wright case takes another turn, attorney says: “If they knock Wright’s credibility down too far, it could have unintended consequences in how a judge or jury views the claim”\",\"url\":\"https://cointelegraph.com/news/wright-v-kleiman-enters-final-act-document-reveal-may-set-precedent\",\"urlToImage\":\"https://images.cointelegraph.com/images/740_aHR0cHM6Ly9zMy5jb2ludGVsZWdyYXBoLmNvbS9zdG9yYWdlL3VwbG9hZHMvdmlldy9jMmE3NGI1M2U3ZDk2OGZiNzFiMjk0NTQ5Mjc4YmVmMC5qcGc=.jpg\",\"publishedAt\":\"2020-04-17T14:43:00Z\",\"content\":\"Another episode of the Kleiman v. Wright saga concluded Monday with District Court Judge Beth Bloom ordering Craig Wright to turn over the 11,000-plus documents that Wright had declared “privileged.”\\r\\nRiveting the crypto world for more than two years, the cas… [+8707 chars]\"},{\"source\":{\"id\":null,\"name\":\"Hwupgrade.it\"},\"author\":null,\"title\":\"Coronavirus: Gmail blocca 18 milioni di phishing ogni giorno\",\"description\":\"Le attività di phishing che sfruttano l'attenzione verso la pandemia COVID-19 e che sono bloccate dai sistemi di Google rappresentano il 20% di tutte le minacce quotidiane\",\"url\":\"https://www.hwupgrade.it/news/sicurezza-software/coronavirus-gmail-blocca-18-milioni-di-phishing-ogni-giorno_88683.html\",\"urlToImage\":\"https://www.hwupgrade.it/i/n/Gmailappterze_720.jpg\",\"publishedAt\":\"2020-04-17T14:21:01Z\",\"content\":\"Google ha dichiarato di intercettare una quantità impressionante di email contenenti malware e azioni di phishing correlate al coronavirus e alla pandemia COVID-19: 18 milioni al giorno, solo nella scorsa settimana.\\r\\nPer mettere le cose in proporzione questo … [+2621 chars]\"},{\"source\":{\"id\":null,\"name\":\"Cointelegraph.com\"},\"author\":\"Cointelegraph By Adrian Zmudzinski\",\"title\":\"COVID-19 Takes an Enormous Toll on Swiss 'Crypto Valley'\",\"description\":\"Swiss Crypto Valley Assoc President said that the Coronavirus pandemic had a major impact on the local crypto ecosystem\",\"url\":\"https://cointelegraph.com/news/covid-19-takes-an-enormous-toll-on-swiss-crypto-valley\",\"urlToImage\":\"https://images.cointelegraph.com/images/740_aHR0cHM6Ly9zMy5jb2ludGVsZWdyYXBoLmNvbS9zdG9yYWdlL3VwbG9hZHMvdmlldy8xZmU0ZTU1MDIxNzBjZTc3NDkwNDc0YTJkYTE1YzdjZC5qcGc=.jpg\",\"publishedAt\":\"2020-04-17T14:13:00Z\",\"content\":\"The President of the Swiss Crypto Valley Association, or CVA, said that the Coronavirus pandemic had a major impact on the local crypto ecosystem.\\r\\nA recent report claims that the representatives of nearly 80% of crypto valley’s firms said they will most like… [+4554 chars]\"},{\"source\":{\"id\":null,\"name\":\"Vox.com\"},\"author\":\"Rebecca Heilweil\",\"title\":\"Coronavirus scammers are flooding social media with fake cures and tests\",\"description\":\"Your guide to the scam-filled digital black market for Covid-19 products\",\"url\":\"https://www.vox.com/recode/2020/4/17/21221692/digital-black-market-covid-19-coronavirus-instagram-twitter-ebay\",\"urlToImage\":\"https://cdn.vox-cdn.com/thumbor/i14RD50332S1_gxHJwEe5MjLrF0=/0x27:2000x1074/fit-in/1200x630/cdn.vox-cdn.com/uploads/chorus_asset/file/19902707/jbareham_020415_vox1012_fake_cures_0001.jpg\",\"publishedAt\":\"2020-04-17T14:05:00Z\",\"content\":\"James Bareham for Recode/Vox Your guide to the scam-filled digital black market for Covid-19 products For years, Timothy Mackey has been researching the sale of opioids and illicit drugs online, tracking how dealers have used social media to push controlled s… [+12302 chars]\"},{\"source\":{\"id\":null,\"name\":\"Seekingalpha.com\"},\"author\":\"Vandana Singh\",\"title\":\"On the hour\",\"description\":\"<ul><li>Dow <font color=\\\"green\\\">+2.35%.</font></li><li>10-yr <font color=\\\"green\\\">+0.15%</font>.</li><li>Euro <font color=\\\"green\\\">+0.49%</font> vs. dollar.</li><li>Crude <font color=\\\"red\\\">-8.91%</font> to $18.12.</li><li>Gold <font color=\\\"red\\\">-0.87%</font> to…\",\"url\":\"https://seekingalpha.com/news/3561683-on-hour\",\"urlToImage\":\"https://static3.seekingalpha.com/assets/og_image_192-59bfd51c9fe6af025b2f9f96c807e46f8e2f06c5ae787b15bf1423e6c676d4db.png\",\"publishedAt\":\"2020-04-17T14:01:29Z\",\"content\":\"Dow +2.35%.\\r\\n10-yr +0.15%.\\r\\nEuro +0.49% vs. dollar.\\r\\nCrude -8.91% to $18.12.\\r\\nGold -0.87% to $1,716.40.\\r\\nBitcoin +1.06% to $7,081.7.\"},{\"source\":{\"id\":null,\"name\":\"Newsbtc.com\"},\"author\":\"Nick Chong\",\"title\":\"Bitcoin’s Recent Action Eerily Identical to $10,500 Top, Buyers Be Aware\",\"description\":\"Despite the bearish macroeconomic view, Bitcoin has performed extremely well over the past few weeks, rallying from the $3,700 lows to a high of $7,500 just last week. Even after a slight correction, the cryptocurrency remains around 90% higher than it did du…\",\"url\":\"https://www.newsbtc.com/2020/04/17/bitcoin-recent-action-eerily-identical-to-10500-top/\",\"urlToImage\":\"https://www.newsbtc.com/wp-content/uploads/2020/04/marc-olivier-jodoin-TQUERQGUZ8-unsplash-1200x780.jpg\",\"publishedAt\":\"2020-04-17T14:00:30Z\",\"content\":\"Despite the bearish macroeconomic view, Bitcoin has performed extremely well over the past few weeks, rallying from the $3,700 lows to a high of $7,500 just last week. Even after a slight correction, the cryptocurrency remains around 90% higher than it did du… [+2561 chars]\"},{\"source\":{\"id\":null,\"name\":\"Www.gov.uk\"},\"author\":\"The Charity Commission\",\"title\":\"Coronavirus (COVID-19): increased risk of fraud and cybercrime against charities\",\"description\":\"This alert provides information and advice for charities about coronavirus (COVID-19) related fraud and cybercrime.\",\"url\":\"https://www.gov.uk/government/news/coronavirus-covid-19-increased-risk-of-fraud-and-cybercrime-against-charities\",\"urlToImage\":\"https://assets.publishing.service.gov.uk/government/uploads/system/uploads/image_data/file/98203/s960_screen_padlock_computer.png\",\"publishedAt\":\"2020-04-17T13:58:52Z\",\"content\":\"Fraudsters are exploiting the spread of coronavirus (COVID-19) in order to carry out fraud and cybercrime. Police have reported an increase in coronavirus related scams.\\r\\nWe are issuing this alert to help charities minimise the risk of becoming a victim of su… [+3656 chars]\"},{\"source\":{\"id\":null,\"name\":\"Seclists.org\"},\"author\":null,\"title\":\"Re: Constant Abuse Reports / Borderline Spamming from RiskIQ\",\"description\":\"Posted by Rich Kulawiec on Apr 17 Sure. These are just examples and are by no means exhaustive. Also, some will work better than others depending on who you are, what services you offer, where you are, etc. There's no substitute for human judgment seasoned wi…\",\"url\":\"https://seclists.org/nanog/2020/Apr/229\",\"urlToImage\":\"http://seclists.org/images/nanog-img.png\",\"publishedAt\":\"2020-04-17T13:52:07Z\",\"content\":\"nanog\\r\\nmailing list archives\\r\\nRe: Constant Abuse Reports / Borderline Spamming from RiskIQ\\r\\nFrom: Rich Kulawiec &lt;rsk () gsp org&gt;Date: Fri, 17 Apr 2020 09:51:25 -0400\\r\\nOn Wed, Apr 15, 2020 at 11:33:58PM -0400, Ross Tajvar wrote:\\r\\nCan you give some exampl… [+3891 chars]\"},{\"source\":{\"id\":null,\"name\":\"Cointelegraph.com\"},\"author\":\"Cointelegraph By Joseph Young\",\"title\":\"Crypto Traders Warn Big Bitcoin Price Plunge Is Around the Corner After Stagnancy\",\"description\":\"Bitcoin has been stuck in the same range for two weeks. When BTC remains stagnant for a long time, it tends to see significant volatility in the near-term\",\"url\":\"https://cointelegraph.com/news/crypto-traders-warn-big-bitcoin-price-plunge-is-around-the-corner-after-stagnancy\",\"urlToImage\":\"https://images.cointelegraph.com/images/740_aHR0cHM6Ly9zMy5jb2ludGVsZWdyYXBoLmNvbS9zdG9yYWdlL3VwbG9hZHMvdmlldy81NmY3NzY1NWY0ODlhOGU0YTdlYWMxZmFjMTY5MDQwMS5qcGc=.jpg\",\"publishedAt\":\"2020-04-17T13:32:00Z\",\"content\":\"For 15 days, the Bitcoin price has been stuck in the same range, consolidating at the same support level at $6,700. Although BTC surged to as high as $7,400 recently, it failed to test a key resistance level at $7,700 and has been stagnant since. Often, when … [+7607 chars]\"},{\"source\":{\"id\":null,\"name\":\"Vac.dev\"},\"author\":null,\"title\":\"What Would a WeChat Replacement Need?\",\"description\":\"What would a self-sovereign, private, censorship-resistant and open alternative to WeChat look like?\",\"url\":\"https://vac.dev/wechat-replacement-need\",\"urlToImage\":\"https://vac.dev/assets/img/tianstatue.jpg\",\"publishedAt\":\"2020-04-17T13:18:46Z\",\"content\":\"What would it take to replace WeChat? More specifically, what would a self-sovereign, private, censorship-resistant and open alternative look like? One that allows people to communicate, coordinate and transact freely.\\r\\nBackground\\r\\nWhat WeChat provides to the… [+29813 chars]\"},{\"source\":{\"id\":null,\"name\":\"Zdnet.fr\"},\"author\":\"Catalin Cimpanu\",\"title\":\"Un malware pour presse-papiers dans 725 bibliothèques Ruby\",\"description\":\"Le malware remplacerait les adresses Bitcoin copiées dans le presse-papiers par une adresse contrôlée par l'attaquant.\",\"url\":\"https://www.zdnet.fr/actualites/un-malware-pour-presse-papiers-dans-725-bibliotheques-ruby-39902413.htm\",\"urlToImage\":\"https://d1fmx1rbmqrxrr.cloudfront.net/zdnet/i/edit/ne/2018/07/cyberattaque.jpg\",\"publishedAt\":\"2020-04-17T13:15:01Z\",\"content\":\"Les paquets malveillants ont été téléchargés sur RubyGems entre le 16 et le 25 février par deux comptes : JimCarrey et PeterGibbons. Les 725 bibliothèques, qui sont listées ici en entier, ont été supprimées deux jours plus tard, le 27 février, après que l'équ… [+2120 chars]\"},{\"source\":{\"id\":\"independent\",\"name\":\"Independent\"},\"author\":\"Andrew Griffin, Andrew Griffin\",\"title\":\"Google users being hit by 18 million coronavirus-themed scam emails each day\",\"description\":\"Attackers using 'fear and financial incentives' to lure people into malicious messages\",\"url\":\"https://www.independent.co.uk/life-style/gadgets-and-tech/news/google-coronavirus-covid-19-scam-email-malware-fraud-phishing-world-health-organisation-a9470856.html\",\"urlToImage\":\"https://static.independent.co.uk/s3fs-public/thumbnails/image/2020/04/17/15/coronavirus.jpg\",\"publishedAt\":\"2020-04-17T13:12:00Z\",\"content\":\"Millions of people are being hit by coronavirus-themed scam messages each day, Google has said.\\r\\nThe company is being forced to block 18 million of the messages per day, as cyber criminals attempt to use the outbreak to lure people into fraud and other attack… [+4487 chars]\"}]}";
    }

    @Override
    public void run() {
        getAllNews();
    }
}
